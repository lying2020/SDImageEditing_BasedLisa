# SmartFreeEdit å¿«é€Ÿå¼€å§‹æŒ‡å—

## âœ… æ¨¡å‹çŠ¶æ€æ£€æŸ¥

ä½ çš„æ¨¡å‹è·¯å¾„å·²é…ç½®å®Œæˆï¼æ‰€æœ‰æ¨¡å‹æ–‡ä»¶éƒ½å·²å°±ç»ªï¼š

```
âœ… Base Model Path: /home/liying/Documents/smart_free_edit_huggingface/base_model
âœ… BrushNet Path: /home/liying/Documents/smart_free_edit_huggingface/checkpoint-100000/brushnet
âœ… LISA Path: /home/liying/Documents/smart_free_edit_huggingface/LISA-7B-v1-explanatory
âœ… GroundingDINO Path: /home/liying/Documents/smart_free_edit_huggingface/grounding_dino/groundingdino_swint_ogc.pth
```

## ğŸš€ ä¸‰ç§è¿è¡Œæ–¹å¼

### æ–¹å¼1ï¼šGradio Webç•Œé¢ï¼ˆæœ€ç®€å•ï¼Œæ¨èï¼‰

```bash
cd /home/liying/Desktop/IMAGE_EDITE-CVPR-2025/SDImageEditing_SmartFreeEdit

# è®¾ç½®ç¯å¢ƒå˜é‡
export PYTHONPATH=.:$PYTHONPATH
export CUDA_VISIBLE_DEVICES=0

# è¿è¡Œ
python SmartFreeEdit/src/smartfreeedit_app.py
```

ç„¶ååœ¨æµè§ˆå™¨æ‰“å¼€ï¼š`http://localhost:8080`

**åŠŸèƒ½**ï¼š
- ä¸Šä¼ å›¾ç‰‡
- è¾“å…¥ç¼–è¾‘æŒ‡ä»¤ï¼ˆå¦‚ "remove the car"ï¼‰
- è‡ªåŠ¨ç”Ÿæˆmaskå¹¶å®Œæˆç¼–è¾‘
- å¯è§†åŒ–maskå’Œç»“æœ

### æ–¹å¼2ï¼šPythonè„šæœ¬ï¼ˆæ‰¹é‡å¤„ç†ï¼‰

ä½¿ç”¨æä¾›çš„ç¤ºä¾‹è„šæœ¬ï¼š

```bash
# ç¼–è¾‘è„šæœ¬ï¼Œå–æ¶ˆæ³¨é‡Šå¹¶é…ç½®å‚æ•°
python ä½¿ç”¨ç¤ºä¾‹_æœ¬åœ°æ¨ç†.py
```

æˆ–è€…ç›´æ¥ä½¿ç”¨ï¼š

```python
from diffusers import StableDiffusionBrushNetPipeline, BrushNetModel
from PIL import Image
import torch

# åŠ è½½æ¨¡å‹
brushnet = BrushNetModel.from_pretrained(
    "/home/liying/Documents/smart_free_edit_huggingface/checkpoint-100000/brushnet",
    torch_dtype=torch.float16
)
pipe = StableDiffusionBrushNetPipeline.from_pretrained(
    "/home/liying/Documents/smart_free_edit_huggingface/base_model/realisticVisionV60B1_v51VAE",
    brushnet=brushnet,
    torch_dtype=torch.float16
)
pipe.enable_model_cpu_offload()

# æ¨ç†
image = pipe(
    "a beautiful landscape",
    Image.open("input.jpg"),
    Image.open("mask.jpg"),  # ç™½è‰²åŒºåŸŸä¸ºç¼–è¾‘åŒºåŸŸ
    num_inference_steps=50
).images[0]

image.save("output.jpg")
```

### æ–¹å¼3ï¼šå‘½ä»¤è¡Œæµ‹è¯•è„šæœ¬

```bash
python test/ReasonEdit_test.py \
    --save_dir ./results \
    --ReasonEdit_benchmark_dir /path/to/benchmark \
    --api_key your_api_key \
    --end_point https://your-endpoint.openai.azure.com/ \
    --engine 4o
```

## ğŸ“ é…ç½®è¯´æ˜

### æ¨¡å‹è·¯å¾„é…ç½®

æ¨¡å‹è·¯å¾„å·²è‡ªåŠ¨é…ç½®ä¸ºï¼š`/home/liying/Documents/smart_free_edit_huggingface`

å¦‚éœ€ä¿®æ”¹ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š

**æ–¹å¼1ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶**
```bash
vim SmartFreeEdit/config_local.py
# ä¿®æ”¹ SMARTFREEEDIT_MODEL_PATH å˜é‡
```

**æ–¹å¼2ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡**
```bash
export SMARTFREEEDIT_MODEL_PATH="/your/custom/path"
```

### GPT-4o APIé…ç½®ï¼ˆå®Œæ•´æµæ°´çº¿éœ€è¦ï¼‰

åœ¨Gradioç•Œé¢ä¸­é…ç½®ï¼Œæˆ–åœ¨ä½¿ç”¨è„šæœ¬æ—¶ä¼ å…¥å‚æ•°ï¼š

```python
api_key = "your_api_key"
api_version = "2024-08-01-preview"
end_point = "https://your-endpoint.openai.azure.com/"
engine = "4o"
```

## ğŸ’¡ ä½¿ç”¨å»ºè®®

1. **é¦–æ¬¡ä½¿ç”¨**ï¼šå»ºè®®å…ˆè¿è¡ŒGradioç•Œé¢ï¼Œç†Ÿæ‚‰åŠŸèƒ½
2. **æ‰¹é‡å¤„ç†**ï¼šä½¿ç”¨Pythonè„šæœ¬è¿›è¡Œæ‰¹é‡æ¨ç†
3. **æ˜¾å­˜ä¼˜åŒ–**ï¼šå¦‚æœæ˜¾å­˜ä¸è¶³ï¼Œä»£ç å·²è‡ªåŠ¨å¯ç”¨CPU offloadå’Œ8-bité‡åŒ–
4. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - é™ä½åˆ†è¾¨ç‡ï¼ˆ512x512 â†’ 384x384ï¼‰
   - å‡å°‘inference stepsï¼ˆ50 â†’ 30-40ï¼‰
   - ä½¿ç”¨xFormersï¼ˆå¦‚æœå·²å®‰è£…ï¼‰

## âš ï¸ å¸¸è§é—®é¢˜

### 1. æ˜¾å­˜ä¸è¶³ï¼ˆOOMï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä»£ç å·²è‡ªåŠ¨å¯ç”¨CPU offload
- é™ä½åˆ†è¾¨ç‡
- å‡å°‘batch size

### 2. æ¨¡å‹è·¯å¾„é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥è·¯å¾„é…ç½®
python SmartFreeEdit/config_local.py
```

### 3. GPT-4o APIé…ç½®

å¦‚æœä¸æƒ³ä½¿ç”¨GPT-4oï¼Œå¯ä»¥ï¼š
- æ‰‹åŠ¨æä¾›maskï¼ˆä½¿ç”¨æ–¹å¼2çš„ç®€å•æ¨ç†ï¼‰
- ä½¿ç”¨å…¶ä»–VLMæ¨¡å‹ï¼ˆéœ€è¦ä¿®æ”¹ä»£ç ï¼‰

## ğŸ“Š æ€§èƒ½å‚è€ƒ

| é…ç½® | æ˜¾å­˜éœ€æ±‚ | æ¨ç†é€Ÿåº¦ |
|------|---------|---------|
| æœ€ä½ | 16GB | ~30-60ç§’/å¼  |
| æ¨è | 24GB | ~20-40ç§’/å¼  |
| ç†æƒ³ | 40GB+ | ~10-20ç§’/å¼  |

## ğŸ“š æ›´å¤šä¿¡æ¯

- è¯¦ç»†åˆ†ææŠ¥å‘Šï¼š`é¡¹ç›®åˆ†ææŠ¥å‘Š.md`
- ä½¿ç”¨ç¤ºä¾‹ï¼š`ä½¿ç”¨ç¤ºä¾‹_æœ¬åœ°æ¨ç†.py`
- é…ç½®æ–‡ä»¶ï¼š`SmartFreeEdit/config_local.py`

---

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰
